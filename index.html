<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VAR Decision Simulator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #111; color: white; }
    video { width: 100%; max-width: 800px; margin-bottom: 10px; border: 2px solid #ccc; }
    input[type="text"] { width: 60%; padding: 10px; }
    button { padding: 10px 15px; margin: 5px; }
    #score { font-size: 20px; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>VAR Decision Simulator</h1>
  <video id="clip" controls muted></video><br>

  <button onclick="playClip()">Play</button>
  <button onclick="pauseClip()">Pause</button>
  <button onclick="playSlow()">Play at 0.25x</button>
  <button onclick="playHalf()">Play at 0.5x</button>
  <button onclick="rewind()">Rewind 3s</button>
  <button onclick="replayClip()">Replay</button>
  <button onclick="prevFrame()">⏪ Prev Frame</button>
  <button onclick="nextFrame()">⏩ Next Frame</button>

  <br>
  <h3>Make sure to enter who gets what punishment (if any), and what the restart is.</h3>
  <br>
  <input type="text" id="userCall" placeholder="Enter your decision (e.g., red card for keeper, no goal, free kick for grey, offside, play on)">
  <button onclick="submitCall()">Submit Call</button>

  <p id="score">Score: 0</p>
  <p id="feedback"></p>

  <script>
    const clips = [ //               https://catbox.moe/
      {
        src: "https://files.catbox.moe/e9g8y1.mp4",
        correctCalls: ["yellow card for keeper", "goal"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/5gfn4q.mp4",
        correctCalls: ["I dont even know. Initally yellow for grey.", "free kick for red"],
        skipScoring: true
      },
      {
        src: "https://files.catbox.moe/lr37rd.mp4",
        correctCalls: ["red card for green", "free kick for yellow"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/teeqkh.mp4",
        correctCalls: ["yellow card for red", "red card for grey", "free kick for grey"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/udri05.mp4",
        correctCalls: ["yellow card for black", "free kick for red"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/s7zpnh.mp4",
        correctCalls: ["no goal"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/0c540f.mp4",
        correctCalls: ["yellow card for keeper", "retake penalty"],
        skipScoring: false
      },
      {
        src: "https://files.catbox.moe/a6yamn.mp4",
        correctCalls: ["yellow card for white", "free kick for green"],
        skipScoring: false
      }
    ];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    shuffle(clips);

    let currentClip = 0;
    let score = 0;
    const video = document.getElementById("clip");
    const feedback = document.getElementById("feedback");

    function loadClip() {
      if (currentClip >= clips.length) {
        feedback.textContent = "All clips completed!";
        return;
      }
      video.src = clips[currentClip].src;
      video.load();
    }

    function playClip() {
      video.playbackRate = 1.0;
      video.play();
    }

    function pauseClip() {
      video.pause();
    }

    function playSlow() {
      video.playbackRate = 0.25;
      video.play();
    }

    function playHalf() {
      video.playbackRate = 0.5;
      video.play();
    }

    function rewind() {
      video.currentTime = Math.max(video.currentTime - 3, 0);
    }

    function replayClip() {
      video.currentTime = 0;
      video.playbackRate = 1.0;
      video.play();
    }

    function prevFrame() {
      if (!video.paused) return;
      const fps = 30; // estimate
      video.currentTime = Math.max(0, video.currentTime - 1 / fps);
    }

    function nextFrame() {
      if (!video.paused) return;
      const fps = 30; // estimate
      video.currentTime = Math.min(video.duration, video.currentTime + 1 / fps);
    }

    function submitCall() {
      const input = document.getElementById("userCall").value.toLowerCase().trim();
      const clip = clips[currentClip];
      if (!input) return;
    
      let matchCount = 0;
      clip.correctCalls.forEach(correct => {
        if (input.includes(correct.toLowerCase())) {
          matchCount++;
        }
      });
    
      const totalCorrect = clip.correctCalls.length;
      let earned = 0;
      let message = "";
    
      if (!clip.skipScoring) {
        earned = Math.round((matchCount / totalCorrect) * 100);
        score += earned;
        message = `You earned ${earned} points on this call.`;
        document.getElementById("score").textContent = `Score: ${score}`;
      } else {
        message = `Call submitted. No scoring for this clip.`;
      }
    
      const answersText = `Correct Answers: ${clip.correctCalls.join(" | ")}`;
      feedback.innerHTML = `${message}<br>${answersText}`;
    
      currentClip++;
      document.getElementById("userCall").value = "";
    
      // Wait 5 seconds before loading the next clip
      setTimeout(loadClip, 5000);
    }


    loadClip();
  </script>
</body>
</html>
